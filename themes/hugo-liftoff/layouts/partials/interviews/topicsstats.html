{{ $s := newScratch }}
{{ $s.Set "issues" slice }}
{{ $s.Set "idea-internal" slice }}
{{ $s.Set "idea-external" slice }}
{{ $pages := . }}
  {{ range $pages }}
    {{ $s.Add "issues" .Params.data.issues }}
    {{ $s.Add "idea-internal" (index .Params.data "idea-internal") }}
    {{ $s.Add "idea-external" (index .Params.data "idea-external") }}
  {{ end }}
  {{ range (uniq ($s.Get "issues")) }}
    {{ $s.Set (printf "%s" .) 0 }}
  {{ end }}
  {{ range (uniq ($s.Get "idea-internal")) }}
    {{ $s.Set (printf "int%s" .) 0 }}
  {{ end }}
  {{ range (uniq ($s.Get "idea-external")) }}
    {{ $s.Set (printf "ext%s" .) 0 }}
  {{ end }}
  {{ range (uniq ($s.Get "idea-internal")) }}
    {{ $label :=  . }}
    {{ range $pages }}
      {{ $s.Add (printf "int%s" $label) (cond (in (index .Params.data "idea-internal") $label) 1 0) }}
      {{ $s.Add (printf "ext%s" $label) (cond (in (index .Params.data "idea-external") $label) 1 0) }}
    {{ end }}
  {{ end }}
  {{ range (uniq ($s.Get "issues")) }}
    {{ $label :=  . }}
    {{ range $pages }}
      {{ $s.Add (printf "%s" $label) (cond (in .Params.data.issues $label) 1 0) }}
    {{ end }}
  {{ end }}
  
  {{ $ideainternal  := (uniq (sort ($s.Get "idea-internal"))) }}
  {{ $ideaextternal := (uniq (sort ($s.Get "idea-external"))) }}

  <div class="chart list">
    <div>
      <canvas id="myChart"></canvas>
    </div>
    <div>
      <canvas id="horizontal-stacker-bar-chart"></canvas>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <script>
    const ctx = document.getElementById('myChart');
  
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: [{{ range (uniq ($s.Get "issues")) }}{{ . }},{{ end }}],
        datasets: [{
          label: 'Sujets notables',
          data: [{{ range (uniq ($s.Get "issues")) }}{{ $s.Get (printf "%s" .) }},{{ end }}],
          borderWidth: 1
        }]
      },
      options: {
        title: {
          display: true,
          text: 'El√©ments clefs'
        },
        scales: {
          
          y: {
            beginAtZero: true
          }
        }
      }
    });
  </script>
  
  <script>
    var ctx2 = document.getElementById("horizontal-stacker-bar-chart");
    new Chart(ctx2, {
        type: 'bar',
        data: {
            labels: ["Interne", "Externe"],
            datasets: [{
                label: '{{ humanize (index $ideaextternal 0) }}',
                backgroundColor: "#FB3569",
                data: [{{ ($s.Get (printf "int%s" (index $ideainternal 0))) }},{{ ($s.Get (printf "ext%s" (index $ideaextternal 0))) }}],
            }, {
                label: '{{ humanize (index $ideaextternal 1) }}',
                backgroundColor: "#FCDDB0",
                data: [{{ ($s.Get (printf "int%s" (index $ideainternal 1))) }},{{ ($s.Get (printf "ext%s" (index $ideaextternal 1))) }}]
            }, {
                label: '{{ humanize (index $ideaextternal 2) }}',
                backgroundColor: "#82CD47",
                data: [{{ ($s.Get (printf "int%s" (index $ideainternal 2))) }},{{ ($s.Get (printf "ext%s" (index $ideaextternal 2))) }}]
            }],
        },
        options: {
            scales: {
                x: {
                    stacked: true,
                },
                y: {
                    stacked: true
                }
            },
            indexAxis: 'x',
            responsive: true
        }
    });		
</script>